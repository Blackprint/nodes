"use strict";function _classPrivateFieldLooseBase(t,e){if(!{}.hasOwnProperty.call(t,e))throw new TypeError("attempted to use private field on non-instance");return t}var id=0;function _classPrivateFieldLooseKey(t){return"__private_"+id+++"_"+t}if(void 0===window)var window=globalThis;async function imports(t){return"undefined"!=typeof sf&&void 0!==sf.loader?await sf.loader.mjs(t):Promise.all(t.map(t=>import(t)))}imports.task=function(){return"undefined"!=typeof sf&&void 0!==sf.loader?sf.loader.task:null},window.templates||(window.templates={});var _$_=sf.dom||sf.$,__tmplt=window.templates,_sf_internal=window._sf_internal=window._sf_internal||{body_map:{},_replace(t,e){let i=_$_(e);return this.body_map[t]&&this.body_map[t].remove(),this.reinitViews&&this.reinitViews(i),this.body_map[t]=i},append(t,e){_$_(document.body).append(this._replace.apply(this,arguments))},prepend(t,e){_$_(document.body).prepend(this._replace.apply(this,arguments))}};let Blackprint=window.Blackprint.loadScope({url:import.meta.url}),$=sf.$,Context=await Blackprint.getContext("Decoration");var[Coloris]=await Blackprint.DepsLoader.js({window:["Coloris"],local:["@melloware/coloris"],cdn:["https://cdn.jsdelivr.net/npm/@melloware/coloris@0.25.0/dist/umd/coloris.min.js"]});await Blackprint.DepsLoader.css({local:["@melloware/coloris/dist/coloris.css"],cdn:["https://cdn.jsdelivr.net/npm/@melloware/coloris@0.25.0/dist/coloris.min.css"]}),__tmplt["BPIC/Decoration/Group/Default.panel.sf"]='<bppc-decoration-group-default><div class="field title"><span class="name">Title:</span> <span class="help" title="Panel below is derived from Decoration/Group/Default.panel.sf"><i class="fas fa-question-circle"></i></span> <textarea sf-bind="data.title" placeholder="Add title here..."></textarea></div><div class="field textContent"><span class="name">Text Content:</span> <textarea sf-bind="data.textContent" placeholder="Add text content here..."></textarea></div><div class="field color-pick color-1"><span class="name">Background Color:</span> <input sf-bind="data.color" placeholder="#b8b8ff"></div><div class="field color-pick color-2"><span class="name">Font Color:</span> <input sf-bind="data.fontColor" placeholder="black"></div></bppc-decoration-group-default>',Blackprint.space.component("bppc-decoration-group-default",{template:"BPIC/Decoration/Group/Default.panel.sf"},class extends sf.Model{constructor(t,e){super(t,e),this.iface=e,this.data=e.data}init(){let t={themeMode:"dark",format:"hex",clearButton:!0,defaultColor:"#b8b8ff",alpha:!1,swatches:["#abffb0","#ffee82","#ff8282","#82f9ff","#8293ff","#cb82ff","#ff82f7","#ffffff","#969696"]};Coloris(Object.assign({el:"bppc-decoration-group-default .color-1 input"},t)),Coloris(Object.assign({el:"bppc-decoration-group-default .color-2 input"},t))}}),__tmplt["BPIC/Decoration/Group/Default.sf"]='<div class="node" style="transform: translate({{x}}px, {{y}}px);\n\theight: {{data.height}}px;\n\twidth: {{data.width}}px;\n\t{{data.color ? (\'background: \' + data.color + \'6e;\') : \'\'}}\n\tcolor: {{data.fontColor ? data.fontColor : \'black\'}};"><div class="header" style="{{data.color ? (\'background: \' + data.color + \'6e;\') : \'\'}}" @dblclick="doubleClick()" @contextmenu.stopall.prevent="nodeMenu(event)" @dragmove="moveNode(event)" @pointerdown="swapZIndex(event)" @pointerover="nodeHovered(event)" @pointerout="nodeUnhovered(event)">{{data.title}}</div><div class="sides"><div @pointerdown="resize(\'n\')" class="n"></div><div @pointerdown="resize(\'w\')" class="w"></div><div @pointerdown="resize(\'s\')" class="s"></div><div @pointerdown="resize(\'e\')" class="e"></div><div @pointerdown="resize(\'nw\')" class="nw"></div><div @pointerdown="resize(\'ne\')" class="ne"></div><div @pointerdown="resize(\'se\')" class="se"></div><div @pointerdown="resize(\'sw\')" class="sw"></div></div><div class="text-content">{{data.textContent}}</div><sf-template path="Blackprint/nodes/template/other.sf"></sf-template></div>',Blackprint.Sketch.registerInterface("BPIC/Decoration/Group/Default",class extends Blackprint.Interface{constructor(t){super(t),this._groups=[],this._ifaces=[],this._cables=[],this.data=new DecorationGroupDefaultData(this),this._listenSelection=t=>{}}init(){this.node.instance.on("container.selection",this._listenSelection)}exportData(){return{width:Math.round(this.data.width),height:Math.round(this.data.height),title:this.data.title,textContent:this.data.textContent,color:this.data.color,fontColor:this.data.fontColor}}resize(t){let e=this.$space("container").scale;const i=i=>{let a=i.movementX/e,s=i.movementY/e;"n"===t?(this.y+=s,this.data.height-=s):"s"===t?this.data.height+=s:"w"===t?(this.x+=a,this.data.width-=a):"e"===t&&(this.data.width+=a),"nw"===t?(this.x+=a,this.y+=s,this.data.width-=a,this.data.height-=s):"ne"===t?(this.y+=s,this.data.width+=a,this.data.height-=s):"sw"===t?(this.x+=a,this.data.width-=a,this.data.height+=s):"se"===t&&(this.data.width+=a,this.data.height+=s),this.data.width<100&&(this.data.width=100),this.data.height<100&&(this.data.height=100)};let a=$(window).once("pointerup",t=>{a.off("pointermove",i),this.refreshContent(t)}).on("pointermove",i)}doubleClick(){this.$space.sketch.emit("editor.properties.open"),setTimeout(()=>{$("bppc-decoration-group-default .title textarea").focus()},50)}onSelect(){return!1}moveNode(t){if(super.moveNode(t),t.ctrlKey)return;let{_ifaces:e,_cables:i}=this;for(var a=0;a<i.length;a++)i[a].moveCableHead(t,!0);for(a=0;a<e.length;a++){e[a].moveNode(t,!0)}}refreshContent(t,e){let{ifaceList:i}=this.node.instance,a=this.$space("nodes").list,s=this.$space("cables").list,o=this.x,n=this.y,l=this.x+this.data.width,r=this.y+this.data.height,{_groups:d,_ifaces:c,_cables:h}=this;d.length=c.length=h.length=0;for(var p=0,f=s.length;p<f;p++){let t=s[p];if(!1===t.hasBranch&&t.connected)continue;let[e,i]=t.head2;e>=o&&e<=l&&i>=n&&i<=r&&h.push(t)}let u=-1;for(p=0,f=i.length;p<f;p++){let s=i[p];if(s===this)continue;let{x:h,y:f}=s,v=(e?s.$el[0]:sf.Window.source(s.$el,t)).firstElementChild,{offsetWidth:w,offsetHeight:_}=v;if(w+h>=o&&h<=l&&_+f>=n&&f<=r){let t=a.indexOf(s);if(-1==u||u>t)if("Decoration/Group/Default"===s.namespace){(s.x>this.x&&s.w<this.w||s.y>this.y&&s.h<this.h)&&(u=t)}else u=t;if("Decoration/Group/Default"===s.namespace){if(!(s.x>this.x&&s.w<this.w||s.y>this.y&&s.h<this.h))continue;d.push(s)}c.push(s)}}if(-1!==u){let t=a.indexOf(this);u<t&&a.move(t,u)}e||this.node.syncOut("trigger","refreshContent");for(let t=0;t<d.length;t++){let e=d[t],{_ifaces:i,_cables:a}=e;for(let t=h.length-1;t>=0;t--)a.includes(h[t])&&h.splice(t,1);for(let t=c.length-1;t>=0;t--)i.includes(c[t])&&c.splice(t,1)}}swapZIndex(t){this.refreshContent(t),super.swapZIndex(t,!0),Coloris.close();let e=this.$space("container");e.nodeScope.deselectAll(),e.cableScope.deselectAll()}destroy(){this.node.instance.off("container.selection",this._listenSelection)}});var _iface=_classPrivateFieldLooseKey("iface");class DecorationGroupDefaultData{constructor(t){Object.defineProperty(this,_iface,{writable:!0,value:null}),_classPrivateFieldLooseBase(this,_iface)[_iface]=t,this.title="No title",this.textContent="",this.color="",this.fontColor="",this.width=100,this.height=100}dataChanged(t,e){let i=_classPrivateFieldLooseBase(this,_iface)[_iface].node;window.event?.isTrusted&&i.syncOut(t,e),i.notifyEditorDataChanged()}on$title(t){this.dataChanged("title",t)}on$textContent(t){this.dataChanged("textContent",t)}v2m$color(t){this.dataChanged("color",t)}v2m$fontColor(t){this.dataChanged("fontColor",t)}on$width(t){this.dataChanged("width",t)}on$height(t){this.dataChanged("height",t)}}__tmplt["BPIC/Decoration/Text/Notes.sf"]='<div class="node" style="transform: translate({{x}}px, {{y}}px)"><sf-template path="Blackprint/nodes/template/header.sf"></sf-template><div class="content"><textarea sf-bind="data.value"></textarea></div></div>',Blackprint.Sketch.registerInterface("BPIC/Decoration/Text/Notes",class extends Blackprint.Interface{constructor(t){super(t),this.data=new DecorationTextNotesData(this)}init(){setTimeout(()=>this.data.on$value(),1e3)}});var _iface2=_classPrivateFieldLooseKey("iface"),_waitRepaint=_classPrivateFieldLooseKey("waitRepaint");class DecorationTextNotesData{constructor(t){Object.defineProperty(this,_iface2,{writable:!0,value:null}),Object.defineProperty(this,_waitRepaint,{writable:!0,value:!1}),_classPrivateFieldLooseBase(this,_iface2)[_iface2]=t,this.value=""}on$value(t){if(_classPrivateFieldLooseBase(this,_waitRepaint)[_waitRepaint])return;let e=_classPrivateFieldLooseBase(this,_iface2)[_iface2],i=e.node;e.$el("textarea").css("height","5px"),_classPrivateFieldLooseBase(this,_waitRepaint)[_waitRepaint]=!0,$.afterRepaint().then(()=>{var a=e.$el("textarea");a.css("height",a[0].scrollHeight+"px"),_classPrivateFieldLooseBase(this,_waitRepaint)[_waitRepaint]=!1,i.syncOut("value",t),i.notifyEditorDataChanged()})}}
//# sourceMappingURL=nodes-decoration.sf.mjs.map